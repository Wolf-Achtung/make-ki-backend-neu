<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Admin Status</title>
  <style>
    :root { --bg:#0b0c10; --fg:#e8e8e8; --muted:#9aa0a6; --card:#15171c; --acc:#61dafb; }
    body { margin:0; font:14px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; background:var(--bg); color:var(--fg); }
    header { padding:16px 20px; background:#111317; border-bottom:1px solid #222; }
    h1 { margin:0; font-size:18px; }
    main { padding:20px; }
    .grid { display:grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap:14px; }
    .card { background:var(--card); border:1px solid #222; border-radius:8px; padding:14px; }
    table { width:100%; border-collapse:collapse; }
    th, td { border-bottom:1px solid #2a2c31; padding:8px; text-align:left; font-size:13px; }
    th { color:#c9d1d9; }
    .muted { color:var(--muted); }
    code { background:#0f1115; padding:2px 6px; border-radius:4px; }
  </style>
</head>
<body>
<header><h1>Admin Status</h1></header>
<main>
  <div class="grid">
    <div class="card"><strong>Queue-Modus:</strong> {{ 'Redis' if queue_mode == 'Redis' else 'Local' }}</div>
    <div class="card"><strong>PDF-Service:</strong> {{ 'aktiv' if flags.pdf_service else 'inaktiv' }}</div>
    <div class="card"><strong>Features:</strong> <span class="muted">{{ flags }}</span></div>
  </div>
  <h2>Redis Queue</h2>
  <pre class="muted">{{ q }}</pre>
  <h2>Letzte 20 Tasks</h2>
  <table>
    <thead><tr><th>ID</th><th>Status</th><th>Firma</th><th>E‑Mail</th><th>Erstellt</th><th>Fertig</th></tr></thead>
    <tbody>
    {% for t in db.last %}
      <tr>
        <td><code>{{ t.id }}</code></td>
        <td>{{ t.status }}</td>
        <td>{{ t.company or '—' }}</td>
        <td>{{ t.email or '—' }}</td>
        <td>{{ t.created_at }}</td>
        <td>{{ t.finished_at or '—' }}</td>
      </tr>
    {% else %}
      <tr><td colspan="6" class="muted">Keine Tasks</td></tr>
    {% endfor %}
    </tbody>
  </table>
</main>
</body>
</html>
