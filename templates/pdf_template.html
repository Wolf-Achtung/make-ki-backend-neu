<!-- File: templates/pdf_template.html -->
<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <title>{{ meta.title }}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    html,body{margin:0;padding:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif;color:#0f172a;background:#fff;line-height:1.45}
    h1,h2,h3{color:#0f172a;margin:0 0 .4rem}
    h1{font-size:26px} h2{font-size:20px} h3{font-size:16px}
    p{margin:.35rem 0}
    .wrap{max-width:1180px;margin:0 auto;padding:28px}
    header{display:flex;justify-content:space-between;align-items:center;margin-bottom:14px}
    .brand{display:flex;align-items:center;gap:12px}
    .brand img{height:38px}
    .meta{font-size:12px;color:#475569}
    .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:16px}
    .card{background:#fff;border:1px solid #e2e8f0;border-radius:14px;padding:16px}
    .kpi .bar{display:grid;grid-template-columns:160px 1fr 120px;align-items:center;margin:8px 0}
    .kpi .bar__track{position:relative;height:10px;background:#f1f5f9;border-radius:6px;overflow:hidden}
    .kpi .bar__fill{height:10px;background:#3b82f6}
    .kpi .bar__median{position:absolute;top:-2px;bottom:-2px;width:2px;background:#0f172a;opacity:.35}
    .kpi .bar__delta{font-size:12px;color:#475569;margin-left:6px}
    .bm{width:100%;border-collapse:collapse}
    .bm th,.bm td{border-bottom:1px solid #e2e8f0;padding:8px 10px;text-align:left;font-size:13px}
    .badge{display:inline-block;border-radius:24px;padding:6px 10px;font-weight:700;font-size:12px}
    .badge.BASIC{background:#fee2e2;color:#991b1b}
    .badge.FAIR{background:#fff7ed;color:#9a3412}
    .badge.GOOD{background:#dcfce7;color:#166534}
    .badge.EXCELLENT{background:#e0f2fe;color:#075985}
    .muted{color:#64748b}
    .hl{font-weight:700}
    .note{background:#fff7ed;border:1px solid #fdba74;color:#7c2d12;padding:12px;border-radius:10px}
    .columns{columns:2;column-gap:16px}
    .footnotes{font-size:12px;color:#475569;margin-top:8px}
    footer{margin-top:24px;padding-top:10px;border-top:1px solid #e2e8f0;font-size:12px;color:#475569}
    .label{font-size:12px;color:#475569}
    .table{width:100%;border-collapse:collapse}
    .table th,.table td{border-bottom:1px solid #e2e8f0;padding:8px 10px;font-size:13px;text-align:left}
    .pill{display:inline-block;padding:6px 10px;border-radius:999px;background:#f1f5f9;color:#0f172a;font-size:12px}
    .badge-row{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px}
    .num{font-variant-numeric:tabular-nums}
  </style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="brand">
      <img src="assets/logo.svg" alt="KI‑Sicherheit.jetzt Logo" />
      <div>
        <div class="hl">KI‑Status‑Report</div>
        <div class="meta">TÜV Austria zertifiziert · EU AI · DSGVO</div>
      </div>
    </div>
    <div class="meta">
      Branche: {{ briefing.branche_label or briefing.branche or "—" }} · Größe: {{ briefing.unternehmensgroesse_label }} · Stand: {{ meta.date }}
    </div>
  </header>

  <!-- Score + KPIs + Business Case -->
  <section class="grid">
    <div class="card" style="grid-column: span 4;">
      <h2>Score</h2>
      <div style="font-size:32px;font-weight:800">{{ '%.1f'|format(score_percent) }}%</div>
      <div class="label">Qualität: <span class="badge {{ quality_badge.grade }}">{{ quality_badge.grade }}</span></div>
    </div>
    <div class="card kpi" style="grid-column: span 5;">
      <h2>Kern‑KPIs</h2>
      {{ kpis_progress_html | safe }}
    </div>
    <div class="card" style="grid-column: span 3;">
      <h2>Business Case</h2>
      <div class="label">Baseline Payback ≈ <b>4&nbsp;Monate</b></div>
      <ul style="margin:.3rem 0 0 1rem;padding:0">
        <li>Investition: <span class="num">{{ business_case.invest_eur | int }} €</span></li>
        <li>Einsparung/Jahr: <span class="num">{{ business_case.annual_saving_eur | int }} €</span></li>
        <li>Payback: <span class="num">{{ business_case.payback_months }}</span> Monate · ROI Jahr 1: <span class="num">{{ business_case.roi_year1_pct }}%</span></li>
      </ul>
    </div>
  </section>

  <!-- Unternehmensprofil & Ziele (Freitextfelder) -->
  {% if sections.profile_html %}
  <section class="card" style="margin-top:12px">
    <h2>Unternehmensprofil &amp; Ziele (aus Ihrem Fragebogen)</h2>
    <div class="muted">Die folgenden Punkte personalisieren Executive Summary, Quick Wins, Empfehlungen &amp; Roadmap.</div>
    {{ sections.profile_html | safe }}
    {% if sections.profile_kpi_badges %}
    <div class="badge-row">
      {% for b in sections.profile_kpi_badges %}
        <span class="pill">{{ b }}</span>
      {% endfor %}
    </div>
    {% endif %}
  </section>
  {% endif %}

  <!-- Benchmarks -->
  <section class="card" style="margin-top:12px">
    <h2>Benchmark‑Vergleich</h2>
    {{ kpis_benchmark_table_html | safe }}
  </section>

  <!-- Executive Summary + Quick Wins -->
  <section class="grid" style="margin-top:12px">
    <div class="card" style="grid-column: span 6;">
      <h2>Executive Summary</h2>
      {{ sections.executive_summary_html | safe }}
      <div class="meta">Stand: {{ meta.date }}</div>
    </div>
    <div class="card" style="grid-column: span 6;">
      <h2>Quick Wins</h2>
      {{ sections.quick_wins_html | safe }}
      <div class="meta">Stand: {{ meta.date }}</div>
    </div>
  </section>

  <section class="card">
    <h2>Roadmap (12 Wochen)</h2>
    {{ sections.roadmap_html | safe }}
    <div class="meta">Stand: {{ meta.date }}</div>
  </section>

  <!-- Risiken & Compliance -->
  <section class="grid" style="margin-top:12px">
    <div class="card" style="grid-column: span 7;">
      <h2>Risiken &amp; Mitigation</h2>
      {{ sections.risks_html | safe }}
      <div class="meta">Stand: {{ meta.date }}</div>
    </div>
    <div class="card" style="grid-column: span 5;">
      <h2>Compliance</h2>
      {{ sections.compliance_html | safe }}
      <div class="meta">Stand: {{ meta.date }}</div>
    </div>
  </section>

  <!-- Branchenkontext -->
  {% if sections.industry_context_html %}
  <section class="card" style="margin-top:12px">
    <h2>Branchenkontext</h2>
    {{ sections.industry_context_html | safe }}
  </section>
  {% endif %}

  <!-- Live: News / Tools / Förderungen -->
  <section class="grid" style="margin-top:12px">
    <div class="card" style="grid-column: span 6;">
      <h2>Aktuelle News (Live)</h2>
      {% if not live.enabled %}
        <div class="muted">{{ live.note }}</div>
      {% elif not live.news %}
        <div class="muted">Keine aktuellen News gefunden (Suche bis 30 Tage geprüft).</div>
      {% else %}
        <ul>
          {% for n in live.news %}
            <li>{{ n.title }} <span class="muted">[{{ loop.index }}]</span></li>
          {% endfor %}
        </ul>
      {% endif %}
      {% if live.news and live.news_sources %}
      <div class="footnotes">
        <div><b>Quellen (News):</b></div>
        <ol>
          {% for s in live.news_sources %}
            <li>[{{ s.id }}] {{ s.title }} – {{ s.domain }}{% if s.date %} ({{ s.date }}){% endif %}</li>
          {% endfor %}
        </ol>
      </div>
      {% endif %}
      <div class="muted">Letztes Live‑Update: {{ meta.date }}</div>
    </div>

    <div class="card" style="grid-column: span 6;">
      <h2>Tools (Live)</h2>
      <div class="note"><b>Hinweis (Non‑EU‑Tools):</b> Einsatz nur mit AVV/SCC, Pseudonymisierung, keine personenbezogenen Daten/Geheimnisse, Log‑Einstellungen prüfen, Rollenkonzepte &amp; Fallback‑EU‑Alternative bereitstellen.</div>
      {% if not live.enabled and not live.tools %}
        <div class="muted">{{ live.note }}</div>
      {% else %}
        <ul>
          {% for t in live.tools %}
            <li><a href="{{ t.url }}" target="_blank" rel="noopener noreferrer">{{ t.title or t.name }}</a>{% if t.desc %} – {{ t.desc }}{% endif %}</li>
          {% endfor %}
        </ul>
      {% endif %}
      {% if live.tools and live.tools_sources %}
      <div class="footnotes">
        <div><b>Quellen (Tools):</b></div>
        <ol>
          {% for s in live.tools_sources %}
            <li>[{{ s.id }}] {{ s.title }} – {{ s.domain }}{% if s.date %} ({{ s.date }}){% endif %}</li>
          {% endfor %}
        </ol>
      </div>
      {% endif %}
      <div class="muted">Letztes Live‑Update: {{ meta.date }}</div>
    </div>
  </section>

  <section class="card" style="margin-top:12px">
    <h2>Förderprogramme (Live)</h2>
    {% if not live.enabled and not live.funding %}
      <div class="muted">{{ live.note }}</div>
    {% else %}
      <ul>
        {% for f in live.funding %}
          <li><a href="{{ f.url }}" target="_blank" rel="noopener noreferrer">{{ f.title or f.name }}</a>{% if f.desc %} – {{ f.desc }}{% endif %}</li>
        {% endfor %}
      </ul>
    {% endif %}
    {% if live.funding and live.funding_sources %}
    <div class="footnotes">
      <div><b>Quellen (Förderungen):</b></div>
      <ol>
        {% for s in live.funding_sources %}
          <li>[{{ s.id }}] {{ s.title }} – {{ s.domain }}{% if s.date %} ({{ s.date }}){% endif %}</li>
        {% endfor %}
      </ol>
    </div>
    {% endif %}
    <div class="meta">Stand: {{ meta.date }}</div>
  </section>

  <!-- Strategie-Add-ons -->
  <section class="grid" style="margin-top:12px">
    <div class="card" style="grid-column: span 6;">
      <h2>Empfehlungen</h2>
      {{ sections.recommendations_html | safe }}
      <div class="meta">Stand: {{ meta.date }}</div>
    </div>
    <div class="card" style="grid-column: span 6;">
      <h2>Game Changer</h2>
      {{ sections.gamechanger_html | safe }}
      <div class="meta">Stand: {{ meta.date }}</div>
    </div>
  </section>

  <section class="grid" style="margin-top:12px">
    <div class="card" style="grid-column: span 6;">
      <h2>Vision</h2>
      {{ sections.vision_html | safe }}
      <div class="meta">Stand: {{ meta.date }}</div>
    </div>
    <div class="card" style="grid-column: span 6;">
      <h2>Enablement (Coach)</h2>
      {{ sections.coach_html | safe }}
      <div class="meta">Stand: {{ meta.date }}</div>
    </div>
  </section>

  <!-- Case & Persona optional -->
  {% if sections.praxisbeispiel_html or sections.persona_html %}
  <section class="grid" style="margin-top:12px">
    {% if sections.praxisbeispiel_html %}
    <div class="card" style="grid-column: span 6;">
      <h2>Praxisbeispiel</h2>
      {{ sections.praxisbeispiel_html | safe }}
      <div class="meta">Stand: {{ meta.date }}</div>
    </div>
    {% endif %}
    {% if sections.persona_html %}
    <div class="card" style="grid-column: span 6;">
      <h2>Buyer Persona</h2>
      {{ sections.persona_html | safe }}
      <div class="meta">Stand: {{ meta.date }}</div>
    </div>
    {% endif %}
  </section>
  {% endif %}

  <!-- Appendix -->
  {% if sections.appendix_checklists_html %}
  <section class="card" style="margin-top:12px">
    <h2>Appendix – Checklisten</h2>
    <div class="columns">
      {{ sections.appendix_checklists_html | safe }}
    </div>
  </section>
  {% endif %}

  <footer>
    <div>{{ score_legend }}</div>
    <div>TÜV Austria · KI‑Ready 2025 · EU AI · DSGVO · © KI‑Sicherheit.jetzt</div>
  </footer>
</div>
</body>
</html>
