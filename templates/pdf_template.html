<!doctype html>
    <html lang="de">
    <head>
      <meta charset="utf-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1" />
      <title>KI-Status-Report</title>
      <style>
        :root{
          /* Updated brand colours to match the website: deep blue and soft green */
          --brand-blue:#0B314F;
          --brand-green:#62C6A4;
          --ink:#0a122a;
          --muted:#5b6b7a;
          --bg:#f6f9fc;
          --card:#ffffff;
          --border:#e5ecf4;
        }
        *{box-sizing:border-box}
        html,body{margin:0;padding:0;font:15px/1.65 Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:var(--ink);background:var(--bg)}
        h1,h2,h3{
          margin:0 0 .6rem 0;
          font-weight:700;
        }
        /* Enlarge headings and add more spacing for improved readability */
        h1{
          font-size:36px;
          margin-bottom:1rem;
        }
        h2{
          font-size:26px;
          border-bottom:2px solid var(--border);
          padding-bottom:.6rem;
          margin-top:1.8rem;
          margin-bottom:.8rem;
        }
        h3{
          font-size:20px;
          margin:1.2rem 0 .6rem;
        }
        p{
          /* Provide more breathing room and a comfortable line height */
          margin:.6rem 0;
          line-height:1.7;
        }
        small,em{color:var(--muted)}
        ul,ol{margin:.4rem 0 .6rem 1.2rem} a{color:var(--brand-blue);text-
decoration:none;border-bottom:1px solid rgba(31,102,255,.35)}
        .container{padding:22px}
.header{display:flex;align-items:center;justify-content:space-between;background:var(--card);color:var(--ink);border-bottom:2px solid var(--brand-blue)}
        .header .inner{display:flex;gap:16px;align-items:center;padding:14px 
22px}
        .header img{height:38px}
        .badge{margin-left:auto;opacity:.95}
.meta{display:flex;gap:18px;flex-wrap:wrap;color:var(--muted);font-size:12px}
        .card{
          background:var(--card);
          border:1px solid var(--border);
          border-left:4px solid var(--brand-blue);
          border-radius:14px;
          padding:24px;
          /* Subtle shadow for depth */
          box-shadow:0 2px 6px rgba(0,0,0,0.05);
        }
        .grid{display:grid;gap:14px}
.grid.cols-2{grid-template-columns:1fr 1fr}
        .footer{margin-top:18px;padding-top:8px;border-top:1px dashed 
var(--border);font-size:12px;color:var(--muted)}
        table{width:100%;border-collapse:collapse;margin:.4rem 0}
        th,td{border:1px solid var(--border);padding:8px;text-
align:left;vertical-align:top}
        th{background:var(--brand-blue);color:#fff}
        .svgbox{background:var(--card);border:1px solid var(--border);border-
radius:14px;padding:10px}
        .caption{font-size:12px;color:var(--muted);margin-top:.25rem}
        @page{size:A4 margin:16mm}
        .onepager{page-break-inside:avoid}
        .section{page-break-inside:auto;page-break-before:always;break-before:page;margin-top:2rem}
        .toc-card{background:var(--card);border:1px dashed var(--border);border-
radius:14px;padding:14px}
        .vision-card{background:linear-gradient(180deg, rgba(24,169,153,.08), 
rgba(31,102,255,.08));border:1px solid rgba(31,102,255,.25);border-left:4px 
solid var(--brand-blue);border-radius:12px;padding:14px;}
        .timeline{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
        .t-card{background:var(--card);border:1px solid var(--border);border-
radius:12px;padding:12px}
        .t-title{font-weight:700;margin-bottom:.2rem}
        .checklist li::marker{content:"☐ "; color:#5b6b7a}
        .checklist li.checked::marker{content:"☑ "; color:#1f66ff}

        /* KPI-Tiles */
        .kpi-grid{display:grid;grid-template-columns:repeat(auto-
fit,minmax(110px,1fr));gap:12px;margin-top:.6rem}
        .kpi-item{border:1px solid var(--border);border-radius:12px;padding:10px;text-align:center}
        /* Colourful KPI cards: assign different tones to the first four items */
        .kpi-item:nth-child(1){background:var(--brand-blue);color:#fff;}
        .kpi-item:nth-child(2){background:#355E8C;color:#fff;}
        .kpi-item:nth-child(3){background:var(--brand-green);color:#fff;}
        .kpi-item:nth-child(4){background:#A0D9C9;color:#fff;}
        .kpi-item .kpi-value{font-size:20px;font-weight:700;margin-bottom:2px}
        /* Hide KPI labels in the gold standard: the descriptive texts are
           summarised in sentences in the executive summary.  This prevents
           stray single-word lines (e.g. "Digitalisierung", "Automatisierung")
           from appearing in the PDF text extraction. */
        .kpi-item .kpi-label{
          font-size:0;
          line-height:0;
          opacity:0;
        }
        /* Benchmark bars */
        .benchmark-bars{margin-top:.6rem}
        .benchmark-row{display:flex;align-items:center;margin-bottom:6px;font-size:12px}
        .benchmark-label{width:90px;color:var(--muted);font-weight:500}
        /* Container for each bar: light grey background and relative positioning */
        .benchmark-bar{flex:1;height:8px;background:#e5ecf4;border-radius:4px;position:relative;overflow:hidden}
        /* The blue bar (your value).  Use relative positioning so the width
           attribute (set inline via style="width:XX%;") applies correctly. */
        .benchmark-bar span.you{
          /* Render the own-value bar as an absolutely positioned element so the
             inline width (set via style="width:XX%;") takes effect.  Without
             absolute positioning the bar may not be visible in some PDF
             renderers. */
          display:block;
          position:absolute;
          left:0;
          top:0;
          height:8px;
          background:var(--brand-blue);
          border-radius:4px;
          z-index:1;
        }
        /* The green marker (industry benchmark) appears as a thin line */
        .benchmark-bar span.avg{
          position:absolute;
          top:-3px;
          width:2px;
          height:14px;
          background:var(--brand-green);
          z-index:2;
        }
        /* Risk heatmap styles (kept for reference but no longer used) */
        .risk-table{width:100%;border-collapse:collapse;margin-top:.6rem;font-size:12px}
        .risk-table th,.risk-table td{border:1px solid var(--border);padding:6px;text-align:center}
        .risk-table th{background:var(--brand-blue);color:#fff}
        .risk-low{background:#D7F3E8!important;}
        .risk-mid{background:#CFE3FF!important;}
        .risk-high{background:#0D3B66!important;color:#fff!important;}
        /* Funding badges */
        .funding-badges{margin-top:.5rem;display:flex;flex-wrap:wrap;gap:6px}
        .funding-badge{padding:4px 8px;border-radius:8px;background:var(--brand-
blue);color:#fff;font-size:10px;white-space:nowrap}
        /* KPI badges */
        .kpi-badges{margin-top:.35rem;display:flex;flex-wrap:wrap;gap:6px}
        .kpi-badge{padding:4px 8px;border-radius:8px;font-size:10px;white-space:nowrap;border:1px solid var(--border)}
        /* Status colours: map English and German classes to same colours */
        .kpi-lead,.kpi-vorsprung{background:#E6F4EA;color:#14532d;border-color:#bbdec4}
        .kpi-on-par,.kpi-gleichauf{background:#EFF6FF;color:#1e3a8a;border-color:#cfe3ff}
        .kpi-behind,.kpi-rueckstand,.kpi-ruckstand{background:#FEE2E2;color:#7f1d1d;border-color:#f5c2c2}
        /* Smaller badges in TOC card */
        .kpi-badges--toc .kpi-badge{font-size:9px;opacity:.9}

    thead { display: table-header-group; }
    tr { page-break-inside: avoid; }
        /* Ensure links do not break in the middle of words.  Without this
           declaration long URLs or tool names may wrap awkwardly in the PDF,
           splitting words across lines.  Use nowrap and disable hyphenation
           for more professional rendering. */
        a {
          white-space: nowrap;
          word-break: normal;
          hyphens: none;
        }

        /* Ensure the Executive Summary card spans the full available width on onepager pages */
        .onepager > .card {
          width: 100%;
        }

      .footnote { page-break-inside: avoid; page-break-after: avoid; margin-top: .2rem; font-size: 9px; color: var(--muted); }
</style>
    <style>
.risk-low{background:#D7F3E8!important;}
.risk-mid{background:#CFE3FF!important;}
.risk-high{background:#0D3B66!important;color:#fff!important;}
.footnote { page-break-inside: avoid; page-break-after: avoid; margin-top: .2rem; font-size: 9px; color: var(--muted); }
</style>
</head>
    <body>
      <div class="header">
        <div class="inner">
          {% if logo_main %}<img src="{{ logo_main }}" alt="KI-Sicherheit" />{% 
endif %}
          <div>
            <h1>KI-Status-Report 2025</h1>
            <div class="meta">
              <div>Datum: {{ datum }}</div><div>Sprache: DE</div>
            </div>
          </div>
          <div class="badge">{% if badge_ready %}<img src="{{ badge_ready }}" 
alt="Badge" style="height:38px">{% endif %}</div>
        </div>
      </div>

      <div class="container">
        <!-- Cover mit großem Gauge -->
        <div class="card">
          <h2>Ihr KI-Status-Überblick</h2>

          {% if preface %}<div style="margin-top:.6rem">{{ preface|safe 
}}</div>{% endif %}
          {% if kpis and kpis|length > 0 %}
            {# KPI tiles removed in the Gold‑Standard.  The KPI overview appears only in the Executive Summary. #}
          {% endif %}
        </div>

        {% if toc_html and toc_html|trim %}
          <div class="card toc-card">
            <h2>Inhaltsverzeichnis</h2>
            {{ toc_html|safe }}
    {# KPI badges removed in Gold‑Standard #}
          </div>
        {% endif %}

        <!-- One-Pager: Executive Summary only -->
        <div class="onepager">
          {# Executive Summary card #}
        {% if exec_summary_html and exec_summary_html|trim %}
          <div class="card">
            <h2>Executive Summary</h2>
            <div class="exec-content" style="margin-top:.6rem">
              {{ exec_summary_html|safe }}
            </div>
          </div>
        {% endif %}
        </div>

        <!-- Quick Wins & Risiken im 2-Spalten-Block -->
        {% if (quick_wins_html and quick_wins_html|trim) or (risks_html and 
risks_html|trim) %}
        <div class="grid cols-2 section">
          <div class="card">
            <h2>Quick Wins</h2>
            <div>{{ (quick_wins_html or '')|safe }}</div>
          </div>
          <div class="card">
            <h2>Hauptrisiken</h2>
            <div>{{ (risks_html or '')|safe }}</div>
          </div>
        </div>
        {% endif %}
        <!-- Empfehlungen & Roadmap -->
        <div class="grid cols-2 section">
          {% if recommendations_html and recommendations_html|trim %}
          <div class="card">
            <h2>Empfehlungen</h2>
            <div>{{ recommendations_html|safe }}</div>
          </div>
          {% endif %}
          {# Roadmap: show timeline when available; otherwise render a 12-month table if structured entries exist; fallback to raw HTML #}
          {% if roadmap_html and roadmap_html|trim or (roadmap_items and roadmap_items|length > 0) %}
          <div class="card">
            <h2>Roadmap</h2>
            {% if timeline and (timeline.t30 or timeline.t90 or timeline.t365) %}
            <div class="swimlane">
              <div>
                <h3>Kurzfristig</h3>
                {% for it in timeline.t30 %}<p>{{ it }}</p>{% endfor %}
              </div>
              <div>
                <h3>Mittelfristig</h3>
                {% for it in timeline.t90 %}<p>{{ it }}</p>{% endfor %}
              </div>
              <div>
                <h3>Langfristig</h3>
                {% for it in timeline.t365 %}<p>{{ it }}</p>{% endfor %}
              </div>
            </div>
            {% elif roadmap_items and roadmap_items|length > 0 %}
            <table class="roadmap-table">
              <thead>
                <tr>
                  <th>Monat</th>
                  <th>Aufgabe</th>
                  <th>Verantwortliche</th>
                  <th>Abhängigkeiten</th>
                  <th>Nutzen</th>
                </tr>
              </thead>
              <tbody>
                {% for item in roadmap_items %}
                <tr>
                  <td>{{ item.month or '' }}</td>
                  <td>{{ item.task or '' }}</td>
                  <td>{{ item.owner or '' }}</td>
                  <td>{{ item.dependencies or '' }}</td>
                  <td>{{ item.benefit or item.outcome or '' }}</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
            {% else %}
            <div>{{ roadmap_html|safe }}</div>
            {% endif %}
          </div>
          {% endif %}
        </div>

        <!-- Förderprogramme (Auswahl) -->
        <div class="section">
          <div class="card">
            <h2>Förderprogramme (Auswahl)</h2>
            {% if foerderprogramme_table and foerderprogramme_table|length>0 %}
              <table>
                <thead>
                  <tr>
                    <th>Programm</th>
                    <th>Zielgruppe</th>
                    <th>Region</th>
                    <th>Zweck</th>
                    <th>Link</th>
                  </tr>
                </thead>
                <tbody>
                {% for p in foerderprogramme_table %}
                  <tr>
                    <td>{{ p.name }}</td>
                    <td>{{ p.zielgruppe }}</td>
                    <td>{{ p.region }}</td>
                    <td>{{ p.zweck }}</td>
                    <td>{% if p.link %}<a href="{{ p.link }}">{{ p.name }}</a>{% endif %}</td>
                  </tr>
                {% endfor %}
                </tbody>
              </table>
              <p class="caption">Stand: {{ funding_stand or datum }}</p>
              {% if funding_badges and funding_badges|length>0 %}
              <div class="funding-badges" style="margin-top:.2rem">
                {% for b in funding_badges %}
                  <span class="funding-badge">{{ b }}</span>
                {% endfor %}
              </div>
              {% endif %}
            {% elif dynamic_funding_html and dynamic_funding_html|trim %}
              {{ dynamic_funding_html|safe }}
            {% else %}
              <p><em>Keine Programme in der Datenbasis.</em></p>
            {% endif %}
          </div>
        </div>

        <!-- KI‑Tools & Software (volle Breite) -->
        <div class="section">
          <div class="card" style="page-break-inside: avoid; page-break-after: avoid;">
            <h2>KI-Tools &amp; Software</h2>
            {% if tools_table and tools_table|length>0 %}
              <table>
                <thead>
                  <tr>
                    <th>Tool</th>
                    <th>Einsatzgebiet</th>
                    <th>Datensitz</th>
                    <th>Link</th>
                  </tr>
                </thead>
                <tbody>
                {% for t in tools_table %}
                  <tr>
                    <td>{{ t.name }}</td>
                    <td>{{ t.usecase }}</td>
                    <td>{{ t.datenschutz or 'n/a' }}</td>
                    <td>{% if t.link %}<a href="{{ t.link }}">{{ t.name }}</a>{% endif %}</td>
                  </tr>
                {% endfor %}
                </tbody>
              </table>
            {% else %}
              <p><em>Tool-Liste wird dynamisch ergänzt.</em></p>
            {% endif %}
          </div>
        </div>

        {# Risk heatmap removed in the Gold‑Standard.  Key risks are described in the text instead. #}

        <!-- Vision separat, nicht doppelt -->
        {% if vision_html %}
          <div class="card section">
            <h2>Vision</h2>
            <div class="vision-card">{{ vision_html|safe }}</div>
          </div>
        {% endif %}

        {# Innovation & Gamechanger section.
           Prefer the LLM-generated gamechanger_html when available.  If
           gamechanger_html is non-empty, render it directly.  Otherwise
           fall back to the branch innovation intro and gamechanger blocks.
        #}
        {% if (gamechanger_html and gamechanger_html|trim) or (gamechanger_blocks and gamechanger_blocks|trim) %}
          <div class="card section">
            <h2>Innovation &amp; Gamechanger</h2>
            {{ gamechanger_html|safe }}
          </div>
        {% elif branchen_innovations_intro or gamechanger_blocks %}
          <div class="card section">
            <h2>Innovation &amp; Gamechanger</h2>
            {% if branchen_innovations_intro %}
              <p>{{ branchen_innovations_intro|safe }}</p>
            {% endif %}
            {% if gamechanger_blocks %}
              {# Render trade-off and description for each block when gamechanger_blocks is a list; otherwise treat as pre-rendered HTML #}
              {% if gamechanger_blocks is string %}
                <div>{{ gamechanger_blocks|safe }}</div>
              {% else %}
                {% for block in gamechanger_blocks %}
                  <div class="gamechanger-block">
                    {% if block.title %}<h3>{{ block.title }}</h3>{% endif %}
                    {% if block.description %}<p>{{ block.description }}</p>{% endif %}
                    {% if block.tradeoff %}<p><strong>Risiken/Nebenwirkungen:</strong> {{ block.tradeoff }}</p>{% endif %}
                  </div>
                {% endfor %}
              {% endif %}
            {% endif %}
          </div>
        {% endif %}

        {% if sections_html %}
          {# Für die aktuelle Testphase zeigen wir keine Praxisbeispiele oder
             weiteren Kapitel an.  sections_html enthält typischerweise den
             Compliance‑Block und das Praxisbeispiel; um das Maschinenbau
             Beispiel zu unterdrücken, wird dieser Block komplett ausgelassen. #}
          {# <div class="card section">
            <h2>Weitere Kapitel</h2>
            <div>{{ sections_html|safe }}</div>
          </div> #}
        {% endif %}

        {% if ueber_mich_html and ueber_mich_html|trim %}
          <div class="card section">
            <h2>Leistung &amp; Nachweis</h2>
            <div>{{ ueber_mich_html|safe }}</div>
            {# QR-Code removed in Gold-Standard #}
          </div>
        {% endif %}

        {% if glossary_html and glossary_html|trim %}
          <div class="card section">
            <h2>Glossar</h2>
            <div>{{ glossary_html|safe }}</div>
          </div>
        {% endif %}

    <div class="card section">
  <div style="margin-top:.2rem;padding:10px 12px;border:1px solid #D5E3F7;border-radius:10px;background:#F6FAFF;">
    <b>Ihre Meinung zählt:</b>
    <a href="https://make.ki-sicherheit.jetzt/feedback/feedback.html?variant={{ unternehmensgroesse|urlencode }}&version={{ datum|default('0.9') }}">Feedback geben (2–3&nbsp;Min.)</a>
  </div>
</div>

    <div class="footer">
      <div style="display:flex;align-items:center;gap:12px">
        {% if logo_tuev %}<img src="{{ logo_tuev }}" alt="TÜV" 
style="height:18px">{% endif %}
        {% if logo_euai %}<img src="{{ logo_euai }}" alt="EU AI" 
style="height:18px">{% endif %}
        {% if logo_dsgvo %}<img src="{{ logo_dsgvo }}" alt="DSGVO" 
style="height:18px">{% endif %}
        <span>© 2025 KI-Sicherheit.jetzt – DSGVO & EU-AI-Act-Ready – Wolf 
Hohl</span>
      </div>
      <div style="margin-top:4px; font-size:11px; color:#6b7280">
        {{ footer_text|safe }}
      </div>
    </div>
      </div>

      <!-- Charts removed: Radar diagram is no longer rendered in the Gold Standard -->
    </body>
    </html>