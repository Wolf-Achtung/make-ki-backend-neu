<!-- File: templates/pdf_template.html -->
<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <title>{{ meta.title }}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    html,body{margin:0;padding:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif;color:#0f172a;background:#fff;line-height:1.45}
    h1,h2,h3{color:#0f172a;margin:0 0 .4rem}
    h1{font-size:26px} h2{font-size:20px} h3{font-size:16px}
    p{margin:.35rem 0}
    .wrap{max-width:1180px;margin:0 auto;padding:28px}
    header{display:flex;justify-content:space-between;align-items:center;margin-bottom:14px}
    .brand{display:flex;align-items:center;gap:12px}
    .brand img{height:38px}
    .meta{font-size:12px;color:#475569}
    .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:16px}
    .card{background:#fff;border:1px solid #e2e8f0;border-radius:14px;padding:16px}
    .kpi .bar{display:grid;grid-template-columns:160px 1fr 160px;align-items:center;margin:8px 0}
    .kpi .bar__track{position:relative;height:10px;background:#f1f5f9;border-radius:6px;overflow:hidden}
    .kpi .bar__fill{height:10px;background:#3b82f6}
    .kpi .bar__median{position:absolute;top:-2px;bottom:-2px;width:2px;background:#0f172a;opacity:.35}
    .kpi .bar__delta{font-size:12px;color:#475569;margin-left:6px}
    .bm{width:100%;border-collapse:collapse}
    .bm th,.bm td{border-bottom:1px solid #e2e8f0;padding:8px 10px;text-align:left;font-size:13px}
    .badge{display:inline-block;border-radius:24px;padding:6px 10px;font-weight:700;font-size:12px}
    .badge.BASIC{background:#fee2e2;color:#991b1b}
    .badge.FAIR{background:#fff7ed;color:#9a3412}
    .badge.GOOD{background:#dcfce7;color:#166534}
    .badge.EXCELLENT{background:#e0f2fe;color:#075985}
    .muted{color:#64748b}
    .hl{font-weight:700}
    .note{background:#fff7ed;border:1px solid #fdba74;color:#7c2d12;padding:12px;border-radius:10px}
    .columns{columns:2;column-gap:16px}
    .footnotes{font-size:12px;color:#475569;margin-top:8px}
    footer{margin-top:24px;padding-top:10px;border-top:1px solid #e2e8f0;font-size:12px;color:#475569}
    .label{font-size:12px;color:#475569}
    .table{width:100%;border-collapse:collapse}
    .table th,.table td{border-bottom:1px solid #e2e8f0;padding:8px 10px;font-size:13px;text-align:left}
    .pill{display:inline-block;padding:6px 10px;border-radius:999px;background:#f1f5f9;color:#0f172a;font-size:12px}
    .badge-row{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px}
    .num{font-variant-numeric:tabular-nums}
    .flag-berlin{display:inline-block;background:#e0f2fe;color:#075985;border:1px solid #bae6fd;border-radius:999px;padding:2px 8px;font-size:11px;margin-left:6px}
  </style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="brand">
      <img src="assets/logo.svg" alt="KI‑Sicherheit.jetzt Logo" />
      <div>
        <div class="hl">{{ meta.title }}</div>
        <div class="meta">TÜV Austria zertifiziert · EU AI · DSGVO</div>
      </div>
    </div>
    <div class="meta">
      Branche: {{ briefing.branche_label }} · Größe: {{ briefing.unternehmensgroesse_label }} · Stand: {{ meta.date }}
    </div>
  </header>

  <!-- Score + KPIs + Business Case -->
  <section class="grid">
    <div class="card" style="grid-column: span 4;">
      <h2>Score</h2>
      <div style="font-size:32px;font-weight:800">{{ "%.1f"|format(score_percent) }}%</div>
      <div class="label">Qualität: <span class="badge {{ quality_badge }}">{{ quality_badge }}</span></div>
    </div>
    <div class="card kpi" style="grid-column: span 5;">
      <h2>Kern‑KPIs</h2>
      {{ kpis_progress_html | safe }}
    </div>
    <div class="card" style="grid-column: span 3;">
      <h2>Business Case</h2>
      <div class="label">Baseline Payback ≈ <b>4&nbsp;Monate</b></div>
      <ul style="margin:.3rem 0 0 1rem;padding:0">
        <li>Investition: <span class="num">{{ business_case.invest_eur }} €</span></li>
        <li>Einsparung/Jahr: <span class="num">{{ business_case.annual_saving_eur }} €</span></li>
        <li>Payback: <span class="num">{{ "%.1f"|format(business_case.payback_months) }}</span> Monate · ROI Jahr 1: <span class="num">{{ "%.1f"|format(business_case.roi_year1_pct) }}%</span></li>
      </ul>
    </div>
  </section>

  <!-- Unternehmensprofil & Ziele -->
  <section class="card" style="margin-top:12px">
    <h2>Unternehmensprofil &amp; Ziele (aus Ihrem Fragebogen)</h2>
    <div class="muted">Die folgenden Punkte personalisieren Executive Summary, Quick Wins, Empfehlungen &amp; Roadmap.</div>
    <ul>
      {% if briefing.hauptleistung %}<li><b>Hauptleistung</b>: {{ briefing.hauptleistung }}</li>{% endif %}
      {% if briefing.ki_projekte %}<li><b>Aktuelle/Geplante KI‑Projekte</b>: {{ briefing.ki_projekte }}</li>{% endif %}
      {% if briefing.ki_potenzial %}<li><b>KI‑Potenzial (Vision)</b>: {{ briefing.ki_potenzial }}</li>{% endif %}
      {% if briefing.strategische_ziele %}<li><b>Strategische Ziele</b>: {{ briefing.strategische_ziele }}</li>{% endif %}
      {% if briefing.projektziel %}<li><b>Projektziele</b>: {{ briefing.projektziel|join(", ") if briefing.projektziel is iterable else briefing.projektziel }}</li>{% endif %}
      {% if briefing.ki_usecases %}<li><b>Fokus‑Use‑Cases</b>: {{ briefing.ki_usecases|join(", ") }}</li>{% endif %}
      {% if briefing.zielgruppen %}<li><b>Zielgruppen</b>: {{ briefing.zielgruppen|join(", ") }}</li>{% endif %}
    </ul>
    <div class="badge-row">
      {% if briefing.usecase_priority %}<span class="pill">Top‑Use‑Case: {{ briefing.usecase_priority|capitalize }}</span>{% endif %}
      {% if briefing.zeitbudget %}<span class="pill">Zeitbudget: {{ ">" if "ueber" in briefing.zeitbudget else "" }}{{ "10 h/W" if "ueber_10" in briefing.zeitbudget else briefing.zeitbudget }}</span>{% endif %}
      {% if briefing.jahresumsatz %}<span class="pill">Umsatzklasse: {{ "100–500 T€" if briefing.jahresumsatz=="100k_500k" else briefing.jahresumsatz }}</span>{% endif %}
    </div>
  </section>

  <!-- Benchmarks -->
  <section class="card" style="margin-top:12px">
    <h2>Benchmark‑Vergleich</h2>
    {{ kpis_benchmark_table_html | safe }}
  </section>

  <!-- Executive Summary + Quick Wins -->
  <section class="grid" style="margin-top:12px">
    <div class="card" style="grid-column: span 6;">
      <h2>Executive Summary</h2>
      {{ sections.executive_summary_html | safe }}
      <div class="meta">Stand: {{ meta.date }}</div>
    </div>
    <div class="card" style="grid-column: span 6;">
      <h2>Quick Wins</h2>
      {{ sections.quick_wins_html | safe }}
      <div class="meta">Stand: {{ meta.date }}</div>
    </div>
  </section>

  <!-- Roadmap -->
  <section class="card" style="margin-top:12px">
    <h2>Roadmap (12 Wochen)</h2>
    {{ sections.roadmap_html | safe }}
    <div class="meta">Stand: {{ meta.date }}</div>
  </section>

  <!-- Risiken & Compliance -->
  <section class="grid" style="margin-top:12px">
    <div class="card" style="grid-column: span 7;">
      <h2>Risiken &amp; Mitigation</h2>
      {{ sections.risks_html | safe }}
      <div class="meta">Stand: {{ meta.date }}</div>
    </div>
    <div class="card" style="grid-column: span 5;">
      <h2>Compliance</h2>
      {{ sections.compliance_html | safe }}
      <div class="meta">Stand: {{ meta.date }}</div>
    </div>
  </section>

  <!-- Branchenkontext -->
  {% if sections.industry_context_html %}
  <section class="card" style="margin-top:12px">
    <h2>Branchenkontext</h2>
    {{ sections.industry_context_html | safe }}
  </section>
  {% endif %}

  <!-- Live: News / Tools / Förderungen -->
  <section class="grid" style="margin-top:12px">
    <div class="card" style="grid-column: span 6;">
      <h2>Aktuelle News (Live)</h2>
      {% if live.news %}
        <ul>
          {% for n in live.news %}
            <li>
              <a href="{{ n.url }}" target="_blank" rel="noopener noreferrer">{{ n.title or n.source }}</a>
              <span class="muted">– {{ n.source }} · {{ n.date }}</span>
            </li>
          {% endfor %}
        </ul>
      {% else %}
        <div class="muted">Keine aktuellen News gefunden (Suche bis {{ live.window_days }} Tage geprüft).</div>
      {% endif %}
      <div class="muted">Letztes Live‑Update: {{ meta.date }}</div>
    </div>

    <div class="card" style="grid-column: span 6;">
      <h2>Tools (Live)</h2>
      <div class="note"><b>Hinweis (Non‑EU‑Tools):</b> Einsatz nur mit AVV/SCC, Pseudonymisierung, keine Geheimnisse/PII, Logging prüfen, RBAC, EU‑Fallback bereitstellen.</div>
      {% if live.tools %}
        <ul>
          {% for t in live.tools %}
            <li>
              <a href="{{ t.url }}" target="_blank" rel="noopener noreferrer">{{ t.title or t.source }}</a>
              <span class="muted">– {{ t.source }}{% if t.eu_hint %} · EU‑Hint{% endif %}</span>
            </li>
          {% endfor %}
        </ul>
      {% endif %}
      <div class="muted">Letztes Live‑Update: {{ meta.date }}</div>
    </div>
  </section>

  <section class="card" style="margin-top:12px">
    <h2>Förderprogramme (Live)</h2>
    {% if live.funding %}
      <ul>
        {% for f in live.funding %}
          <li>
            <a href="{{ f.url }}" target="_blank" rel="noopener noreferrer">{{ f.title or f.source }}</a>
            {% if f.berlin_badge %}<span class="flag-berlin">Land Berlin</span>{% endif %}
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <div class="muted">Keine aktuellen Einträge im Fenster ({{ live.window_days }} Tage).</div>
    {% endif %}
    <div class="meta">Stand: {{ meta.date }}</div>
  </section>

  <!-- Strategie-Add-ons -->
  {% for key in ["recommendations","gamechanger","vision","persona","praxisbeispiel","coach","tools","foerderprogramme","business","doc_digest"] %}
    {% set html = attribute(sections, key ~ "_html") if (key ~ "_html") in sections else "" %}
    {% if html %}
      <section class="card" style="margin-top:12px">
        <h2>{{ key|replace("_"," ")|title }}</h2>
        {{ html | safe }}
        <div class="meta">Stand: {{ meta.date }}</div>
      </section>
    {% endif %}
  {% endfor %}

  <!-- Appendix -->
  {% if sections.appendix_checklists_html %}
  <section class="card" style="margin-top:12px">
    <h2>Appendix – Checklisten</h2>
    <div class="columns">
      {{ sections.appendix_checklists_html | safe }}
    </div>
  </section>
  {% endif %}

  <footer>
    <div>Score 0–54 = Basic · 55–69 = Fair · 70–84 = Good · ≥ 85 = Excellent. Gewichtung: Digitalisierung/Automatisierung/Compliance/Prozessreife/Innovation je 20 %.</div>
    <div>TÜV Austria · KI‑Ready 2025 · EU AI · DSGVO · © KI‑Sicherheit.jetzt</div>
  </footer>
</div>
</body>
</html>
